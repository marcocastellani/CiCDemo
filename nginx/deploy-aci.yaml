api-version: 2019-12-01
location: Sweden Central
name: aci-cicdemoapi$BRANCH
properties:
  containers:
    - name: nginx-with-ssl
      properties:
        image: mcr.microsoft.com/oss/nginx/nginx:1.15.5-alpine
        ports:
          - port: 443
            protocol: TCP
        resources:
          requests:
            cpu: 1.0
            memoryInGB: 1.5
        volumeMounts:
          - name: nginx-config
            mountPath: /etc/nginx
    - name: demo-api
      properties:
        image: $REGISTRY_LOGIN_SERVER/cicdemoapi:$SHA
        environmentVariables:
          - name: ASPNETCORE_URLS
            value: http://*:80
          - name: ASPNETCORE_ENVIRONMENT
            value: Production
          - name: ConnectionStrings__BlogDC
            value: $CONNECTION_STRING

        ports:
          - port: 80
            protocol: TCP
        resources:
          requests:
            cpu: 1.0
            memoryInGB: 1.5
  imageRegistryCredentials: # Credentials to pull a private image
    - server: $REGISTRY_LOGIN_SERVER
      username: $REGISTRY_USERNAME
      password: $REGISTRY_PASSWORD
  volumes:
    - secret:
        ssl.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURiVENDQWxXZ0F3SUJBZ0lVUHRZcksvTUcyak10Q2FscEF2ZmJJcXpNMFVZd0RRWUpLb1pJaHZjTkFRRUwKQlFBd1h6RUxNQWtHQTFVRUJoTUNTVlF4RGpBTUJnTlZCQWdNQlVsMFlXeDVNUkV3RHdZRFZRUUhEQWhHYkc5eQpaVzVqWlRFUE1BMEdBMVVFQ2d3R1VtVnRhWEpoTVJ3d0dnWURWUVFEREJNcUxtRjZkWEpsWTI5dWRHRnBibVZ5CkxtbHZNQjRYRFRJMU1ERXlPREUyTkRneU4xb1hEVEkyTURFeU9ERTJORGd5TjFvd1h6RUxNQWtHQTFVRUJoTUMKU1ZReERqQU1CZ05WQkFnTUJVbDBZV3g1TVJFd0R3WURWUVFIREFoR2JHOXlaVzVqWlRFUE1BMEdBMVVFQ2d3RwpVbVZ0YVhKaE1Sd3dHZ1lEVlFRRERCTXFMbUY2ZFhKbFkyOXVkR0ZwYm1WeUxtbHZNSUlCSWpBTkJna3Foa2lHCjl3MEJBUUVGQUFPQ0FROEFNSUlCQ2dLQ0FRRUF6aDUyM0lsb21JU3VEdzNFRGx4bVhzR1dyRkdzN2tRMXNIUTEKa251RDUyaDMxaDlUTGRUaFhZT0V0d1dRRE9lK3BVc2ZwbHViVTVNZ0NWSlNBajVCT2xyVFl1cEFzWG9QNUd5WApETnpQMEJ4OHNEYkkvR0hPSWFpTlQ1YUlmNTRHWmRyZS8wQTBjRHlteHFlemw0SXRIVC9aeFhzWUFBSGdVVGRBClRSanY3WmlQYmhON1ZhbFBRRWlCY1hJbndtejdxdUQ4cmJNZEgwNTJ0TEtHaTY5Vm1XOHdOeTRuZUtoQjVyNVUKbmg2em9NUnY4UXZrOEk1OHZ0ZXpaRHRlSTJkcG96a3EzZHB6dEhFWERPZUpXLzlZZWR0cWpPd0NKMjhQNGt0eQpGT3E3MTAvVy9zSlUxcFpEc2UvVHRWN3g2S3hFZ2hHMCt6Qlg3a2xSVlFhOG1WYUJ2d0lEQVFBQm95RXdIekFkCkJnTlZIUTRFRmdRVUxWTlgyRkNYSmRTcyt4QXRiT3BBQkVYTVNoc3dEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUIKQUpEZFZyK3FCZWZ5ZWkzZGl4Z3J2dWZId3NXWTYra1d4MTFuR2duamIxSFVTeVdDNi9Hc2VRbHM4U3VvS0JSSwpXY1lOdk1qdFhBV1ZHMEtObHVyS0piMVFVUlpVTktQRlFUdjBxWVhmZWtPT1NqbVhSZ0R6enNwbDlRejJKOFZ6CmFvQitqUjdLQ3FtTlZUMVJjMXRDdCs1SlJIcCtpOXBtWmJVMEFSRDRUanQwMTdRWWlqM3JDMUcwZWg4L0t6dUwKMjRNTzRuQTFSYzZ3WjhuRmFLK2NRMjVJaEk2TDRwYVQ2c2dpYjJQSzFUNlQ1bXJjL2RSZmpCZ0RJb0NZOWlTSAo4RG1DVDkzbjdOQkJ4WmJ4SC9FeUNiVk1RR0tBdU1DcnlkV2JvcjZnSVZyQ0xHeElTWmQzZjRXNnEwTVVXS0lTCm5IWVFWMEtZaHdKTFF2VzRORkk3ZXZBPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
        ssl.key: $NGINX_KEY
        nginx.conf: IyBuZ2lueCBDb25maWd1cmF0aW9uIEZpbGUKIyBodHRwczovL3dpa2kubmdpbngub3JnL0NvbmZpZ3VyYXRpb24KCiMgUnVuIGFzIGEgbGVzcyBwcml2aWxlZ2VkIHVzZXIgZm9yIHNlY3VyaXR5IHJlYXNvbnMuCnVzZXIgbmdpbng7Cgp3b3JrZXJfcHJvY2Vzc2VzIGF1dG87CgpldmVudHMgewogIHdvcmtlcl9jb25uZWN0aW9ucyAxMDI0Owp9CgpwaWQgICAgICAgIC92YXIvcnVuL25naW54LnBpZDsKCmh0dHAgewoKICAgICNSZWRpcmVjdCB0byBodHRwcywgdXNpbmcgMzA3IGluc3RlYWQgb2YgMzAxIHRvIHByZXNlcnZlIHBvc3QgZGF0YQoKICAgIHNlcnZlciB7CiAgICAgICAgbGlzdGVuIFs6Ol06NDQzIHNzbDsKICAgICAgICBsaXN0ZW4gNDQzIHNzbDsKCiAgICAgICAgc2VydmVyX25hbWUgbG9jYWxob3N0OwoKICAgICAgICAjIFByb3RlY3QgYWdhaW5zdCB0aGUgQkVBU1QgYXR0YWNrIGJ5IG5vdCB1c2luZyBTU0x2MyBhdCBhbGwuIElmIHlvdSBuZWVkIHRvIHN1cHBvcnQgb2xkZXIgYnJvd3NlcnMgKElFNikgeW91IG1heSBuZWVkIHRvIGFkZAogICAgICAgICMgU1NMdjMgdG8gdGhlIGxpc3Qgb2YgcHJvdG9jb2xzIGJlbG93LgogICAgICAgIHNzbF9wcm90b2NvbHMgICAgICAgICAgICAgIFRMU3YxLjI7CgogICAgICAgICMgQ2lwaGVycyBzZXQgdG8gYmVzdCBhbGxvdyBwcm90ZWN0aW9uIGZyb20gQmVhc3QsIHdoaWxlIHByb3ZpZGluZyBmb3J3YXJkaW5nIHNlY3JlY3ksIGFzIGRlZmluZWQgYnkgTW96aWxsYSAtIGh0dHBzOi8vd2lraS5tb3ppbGxhLm9yZy9TZWN1cml0eS9TZXJ2ZXJfU2lkZV9UTFMjTmdpbngKICAgICAgICBzc2xfY2lwaGVycyAgICAgICAgICAgICAgICBFQ0RIRS1SU0EtQUVTMTI4LUdDTS1TSEEyNTY6RUNESEUtRUNEU0EtQUVTMTI4LUdDTS1TSEEyNTY6RUNESEUtUlNBLUFFUzI1Ni1HQ00tU0hBMzg0OkVDREhFLUVDRFNBLUFFUzI1Ni1HQ00tU0hBMzg0OkRIRS1SU0EtQUVTMTI4LUdDTS1TSEEyNTY6REhFLURTUy1BRVMxMjgtR0NNLVNIQTI1NjprRURIK0FFU0dDTTpFQ0RIRS1SU0EtQUVTMTI4LVNIQTI1NjpFQ0RIRS1FQ0RTQS1BRVMxMjgtU0hBMjU2OkVDREhFLVJTQS1BRVMxMjgtU0hBOkVDREhFLUVDRFNBLUFFUzEyOC1TSEE6RUNESEUtUlNBLUFFUzI1Ni1TSEEzODQ6RUNESEUtRUNEU0EtQUVTMjU2LVNIQTM4NDpFQ0RIRS1SU0EtQUVTMjU2LVNIQTpFQ0RIRS1FQ0RTQS1BRVMyNTYtU0hBOkRIRS1SU0EtQUVTMTI4LVNIQTI1NjpESEUtUlNBLUFFUzEyOC1TSEE6REhFLURTUy1BRVMxMjgtU0hBMjU2OkRIRS1SU0EtQUVTMjU2LVNIQTI1NjpESEUtRFNTLUFFUzI1Ni1TSEE6REhFLVJTQS1BRVMyNTYtU0hBOkFFUzEyOC1HQ00tU0hBMjU2OkFFUzI1Ni1HQ00tU0hBMzg0OkVDREhFLVJTQS1SQzQtU0hBOkVDREhFLUVDRFNBLVJDNC1TSEE6QUVTMTI4OkFFUzI1NjpSQzQtU0hBOkhJR0g6IWFOVUxMOiFlTlVMTDohRVhQT1JUOiFERVM6ITNERVM6IU1ENTohUFNLOwogICAgICAgIHNzbF9wcmVmZXJfc2VydmVyX2NpcGhlcnMgIG9uOwoKICAgICAgICAjIE9wdGltaXplIFRMUy9TU0wgYnkgY2FjaGluZyBzZXNzaW9uIHBhcmFtZXRlcnMgZm9yIDEwIG1pbnV0ZXMuIFRoaXMgY3V0cyBkb3duIG9uIHRoZSBudW1iZXIgb2YgZXhwZW5zaXZlIFRMUy9TU0wgaGFuZHNoYWtlcy4KICAgICAgICAjIFRoZSBoYW5kc2hha2UgaXMgdGhlIG1vc3QgQ1BVLWludGVuc2l2ZSBvcGVyYXRpb24sIGFuZCBieSBkZWZhdWx0IGl0IGlzIHJlLW5lZ290aWF0ZWQgb24gZXZlcnkgbmV3L3BhcmFsbGVsIGNvbm5lY3Rpb24uCiAgICAgICAgIyBCeSBlbmFibGluZyBhIGNhY2hlIChvZiB0eXBlICJzaGFyZWQgYmV0d2VlbiBhbGwgTmdpbnggd29ya2VycyIpLCB3ZSB0ZWxsIHRoZSBjbGllbnQgdG8gcmUtdXNlIHRoZSBhbHJlYWR5IG5lZ290aWF0ZWQgc3RhdGUuCiAgICAgICAgIyBGdXJ0aGVyIG9wdGltaXphdGlvbiBjYW4gYmUgYWNoaWV2ZWQgYnkgcmFpc2luZyBrZWVwYWxpdmVfdGltZW91dCwgYnV0IHRoYXQgc2hvdWxkbid0IGJlIGRvbmUgdW5sZXNzIHlvdSBzZXJ2ZSBwcmltYXJpbHkgSFRUUFMuCiAgICAgICAgc3NsX3Nlc3Npb25fY2FjaGUgICAgc2hhcmVkOlNTTDoxMG07ICMgYSAxbWIgY2FjaGUgY2FuIGhvbGQgYWJvdXQgNDAwMCBzZXNzaW9ucywgc28gd2UgY2FuIGhvbGQgNDAwMDAgc2Vzc2lvbnMKICAgICAgICBzc2xfc2Vzc2lvbl90aW1lb3V0ICAyNGg7CgoKICAgICAgICAjIFVzZSBhIGhpZ2hlciBrZWVwYWxpdmUgdGltZW91dCB0byByZWR1Y2UgdGhlIG5lZWQgZm9yIHJlcGVhdGVkIGhhbmRzaGFrZXMKICAgICAgICBrZWVwYWxpdmVfdGltZW91dCAzMDA7ICMgdXAgZnJvbSA3NSBzZWNzIGRlZmF1bHQKCiAgICAgICAgIyByZW1lbWJlciB0aGUgY2VydGlmaWNhdGUgZm9yIGEgeWVhciBhbmQgYXV0b21hdGljYWxseSBjb25uZWN0IHRvIEhUVFBTCiAgICAgICAgYWRkX2hlYWRlciBTdHJpY3QtVHJhbnNwb3J0LVNlY3VyaXR5ICdtYXgtYWdlPTMxNTM2MDAwOyBpbmNsdWRlU3ViRG9tYWlucyc7CgogICAgICAgIHNzbF9jZXJ0aWZpY2F0ZSAgICAgIC9ldGMvbmdpbngvc3NsLmNydDsKICAgICAgICBzc2xfY2VydGlmaWNhdGVfa2V5ICAvZXRjL25naW54L3NzbC5rZXk7CgogICAgICAgIGxvY2F0aW9uIC8gewogICAgICAgICAgICBwcm94eV9wYXNzIGh0dHA6Ly9sb2NhbGhvc3Q6ODA7ICMgVE9ETzogcmVwbGFjZSBwb3J0IGlmIGFwcCBsaXN0ZW5zIG9uIHBvcnQgb3RoZXIgdGhhbiA4MAoKICAgICAgICAgICAgcHJveHlfc2V0X2hlYWRlciBDb25uZWN0aW9uICIiOwogICAgICAgICAgICBwcm94eV9zZXRfaGVhZGVyIEhvc3QgJGhvc3Q7CiAgICAgICAgICAgIHByb3h5X3NldF9oZWFkZXIgWC1SZWFsLUlQICRyZW1vdGVfYWRkcjsKICAgICAgICAgICAgcHJveHlfc2V0X2hlYWRlciBYLUZvcndhcmRlZC1Gb3IgJHJlbW90ZV9hZGRyOwogICAgICAgIH0KICAgIH0KfQ==
      name: nginx-config

  ipAddress:
    ports:
      - port: 443
        protocol: TCP
    dnsNameLabel: $RESOURCE_GROUP$BRANCH
    type: Public

  diagnostics:
    logAnalytics:
      workspaceId: cicd-apparound
      workspaceKey: $LOG_ANALYTICS_WORKSPACE_KEY
  osType: Linux
tags: null
type: Microsoft.ContainerInstance/containerGroups
